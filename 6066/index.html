<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hong Kong Landmark AR (Student Version)</title>
    <!-- 引入依赖库（CDN加载，无需本地下载） -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.150.1/build/three.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/three.js/build/threex-artoolkitcore.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/three.js/build/threex-artoolkitcontroller.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/three.js/build/threex-artoolkitsource.js"></script>
    <style>
        /* 隐藏页面边距，让AR画面全屏 */
        body { margin: 0; overflow: hidden; }
        /* 加载提示（避免学生误以为白屏） */
        #loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-family: Arial, sans-serif;
            color: #333;
        }
    </style>
</head>
<body>
    <div id="loading">Loading AR Scene...<br>Please allow camera permission</div>

    <script>
        // Three.js Core: Basic 3D Scene Setup
        // 1.Scene
        const scene = new THREE.Scene();  
        // 2.Camera
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
        // 3.Renderer
        const renderer = new THREE.WebGLRenderer({ antialias: true }); // 抗锯齿，画面更清晰
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        // AR.js Core: 视频源配置（解决摄像头访问问题）
        const arSource = new THREEx.ArToolkitSource({
            sourceType: 'webcam', // 用摄像头作为输入源
            sourceWidth: window.innerWidth,
            sourceHeight: window.innerHeight
        });
        // 监听窗口大小变化，自动适配
        window.addEventListener('resize', function() {
            arSource.onResize();
            arSource.copySizeTo(renderer.domElement);
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
        });
        arSource.init(function() {
            arSource.copySizeTo(renderer.domElement);
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
        });

        // AR.js Core: Bind Marker & 3D Scene（使用HIRO通用标记，无需学生准备文件）
        const arController = new THREEx.ArToolkitController({
            camera: camera,
            renderer: renderer,
            markerPatternUrl: THREEx.ArToolkitContext.baseURL + 'data/patt.hiro', // 自带HIRO标记路径
            detectionMode: 'mono_and_matrix', // 优化识别精度
            matrixCodeType: '3x3',
            threshold: 120 // 识别阈值，适配不同光线
        });
        arController.addEventListener('ready', function() {
            document.getElementById('loading').style.display = 'none'; // 加载完成，隐藏提示
        });
        arController.start(); // Start AR tracking
        scene.add(arController.object3d); // Link AR to 3D scene

        // 学生修改部分：香港地标3D模型（核心个性化区域）
        // 模型几何形状（立方体，可替换为球形/圆柱体）
        const landmarkGeometry = new THREE.BoxGeometry(1.2, 1.8, 1.2); // 宽, 高, 深（0.5-2之间调整）
        // 模型材质（颜色/样式）
        const landmarkMaterial = new THREE.MeshBasicMaterial({ 
            color: 0x3498db, // 模型颜色（可改为0xffd700金色/0x2ecc71绿色）
            wireframe: false, // false=实心，true=线框（可选）
            transparent: false, // 是否透明
            opacity: 1 // 透明度（0-1）
        });
        const myLandmark = new THREE.Mesh(landmarkGeometry, landmarkMaterial);

        // 模型位置&旋转调整（确保在标记上方，不贴地/不偏移）
        myLandmark.position.y = 0.9; // 上下移动（数值越大越靠上，建议0.7-1之间）
        myLandmark.rotation.y = 1.5; // 旋转角度（0-6之间，对应0-360度）
        myLandmark.rotation.x = 0.1; // 轻微倾斜，更有立体感（可选）

        // 将模型添加到AR标记中（固定代码，无需修改）
        arController.object3d.add(myLandmark);

        // 选做交互：点击模型变色（学生可保留/删除）
        renderer.domElement.addEventListener('click', function() {
            const randomColor = Math.random() * 0xffffff; // 随机生成颜色
            myLandmark.material.color.set(randomColor);
        });

        // 选做功能：模型自动旋转（学生可保留/删除，注释掉即可关闭）
        function animate() {
            requestAnimationFrame(animate);
            if (myLandmark) {
                myLandmark.rotation.y += 0.005; // 旋转速度（数值越小越慢）
            }
            // 实时渲染场景
            if (arController && arController.update) {
                arController.update(arSource.domElement);
            }
            renderer.render(scene, camera);
        }
        animate();

        // 控制台提示（帮助学生排查问题）
        console.log('Student AR Project - Tips:');
        console.log('1. Print HIRO marker: https://ar-js-org.github.io/AR.js-Docs/hiro.png');
        console.log('2. Modify landmarkGeometry/color/rotation to customize your model');
        console.log('3. Click the model to change color');
    </script>
</body>
</html>