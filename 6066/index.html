<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hong Kong Landmark AR (Local Marker Version)</title>
    <!-- ç¨³å®šç‰ˆä¾èµ–åº“ï¼ˆå›½å†…å¯è®¿é—®ï¼‰ -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.150.1/build/three.min.js"></script>
    <script src="https://unpkg.com/ar-nft@2.4.0/build/threex-artoolkitcore.js"></script>
    <script src="https://unpkg.com/ar-nft@2.4.0/build/threex-artoolkitcontroller.js"></script>
    <script src="https://unpkg.com/ar-nft@2.4.0/build/threex-artoolkitsource.js"></script>
    <style>
        body { margin: 0; overflow: hidden; }
        #loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-family: Arial, sans-serif;
            color: #333;
        }
    </style>
</head>
<body>
    <div id="loading">Loading AR Scene...<br>Please allow camera permission</div>

    <script>
        // Three.js Core: Basic 3D Scene Setup
        const scene = new THREE.Scene();  
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        // AR.js Core: è§†é¢‘æºé…ç½®
        const arSource = new THREEx.ArToolkitSource({
            sourceType: 'webcam',
            sourceWidth: window.innerWidth,
            sourceHeight: window.innerHeight
        });
        window.addEventListener('resize', function() {
            arSource.onResize();
            arSource.copySizeTo(renderer.domElement);
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
        });
        arSource.init(function() {
            arSource.copySizeTo(renderer.domElement);
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
        });

        // ğŸ”¥ æœ¬åœ°æ ‡è®°é…ç½®ï¼ˆå¼•ç”¨åŒä¸€æ–‡ä»¶å¤¹çš„.pattæ–‡ä»¶ï¼‰
        const arController = new THREEx.ArToolkitController({
            camera: camera,
            renderer: renderer,
            markerPatternUrl: './marker.patt', // æœ¬åœ°è·¯å¾„ï¼Œç¡®ä¿.pattå’ŒHTMLåŒæ–‡ä»¶å¤¹
            detectionMode: 'mono_and_matrix',
            matrixCodeType: '3x3',
            threshold: 120
        });
        arController.addEventListener('ready', function() {
            document.getElementById('loading').style.display = 'none';
        });
        arController.start();
        scene.add(arController.object3d);

        // å­¦ç”Ÿä¿®æ”¹éƒ¨åˆ†ï¼šé¦™æ¸¯åœ°æ ‡3Dæ¨¡å‹ï¼ˆç®€åŒ–ç‰ˆé¦™æ¸¯ä¼šå±•ä¸­å¿ƒï¼‰
        const mainBuilding = new THREE.Mesh(
            new THREE.BoxGeometry(2, 1.5, 1),
            new THREE.MeshBasicMaterial({ color: 0xe74c3c })
        );
        mainBuilding.position.y = 0.75;

        const topPart = new THREE.Mesh(
            new THREE.BoxGeometry(2.2, 0.3, 1.2),
            new THREE.MeshBasicMaterial({ color: 0x3498db })
        );
        topPart.position.y = 2.25;

        const hkcecModel = new THREE.Group();
        hkcecModel.add(mainBuilding);
        hkcecModel.add(topPart);
        arController.object3d.add(hkcecModel);

        // é€‰åšäº¤äº’ï¼šç‚¹å‡»æ¨¡å‹å˜è‰²
        renderer.domElement.addEventListener('click', function() {
            const randomColor = Math.random() * 0xffffff;
            mainBuilding.material.color.set(randomColor);
            topPart.material.color.set(randomColor * 0.8);
        });

        // è‡ªåŠ¨æ—‹è½¬
        function animate() {
            requestAnimationFrame(animate);
            if (hkcecModel) {
                hkcecModel.rotation.y += 0.005;
            }
            if (arController && arController.update) {
                arController.update(arSource.domElement);
            }
            renderer.render(scene, camera);
        }
        animate();

        console.log('Local AR Project - Tips:');
        console.log('1. Ensure marker.patt and marker.png are in the same folder as HTML');
        console.log('2. Print marker.png at 100% scale');
    </script>
</body>
</html>