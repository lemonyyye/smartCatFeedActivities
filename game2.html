<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Process Simplification & Core Flowchart Design</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',
                        secondary: '#10B981',
                        accent: '#EF4444',
                        neutral: '#1F2937',
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .step-active {
                @apply bg-primary text-white border-primary;
            }
            .process-item {
                @apply p-4 mb-2 rounded border transition-all duration-300 cursor-pointer;
            }
            .process-item.highlight {
                @apply border-accent bg-red-50;
            }
            .process-item.removed {
                @apply line-through opacity-50 bg-gray-100;
            }
            .flow-node {
                @apply bg-white p-4 rounded-lg shadow-md border-2 transition-all duration-300 cursor-move;
            }
            .flow-node.active {
                @apply border-primary shadow-lg scale-105;
            }
            .flow-connector {
                @apply absolute bg-gray-400 z-0;
            }
        }
    </style>
</head>
<body class="bg-gray-50 font-sans text-neutral">
    <!-- Top Navigation -->
    <header class="bg-white shadow-md sticky top-0 z-50">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <h1 class="text-xl md:text-2xl font-bold text-primary">
                <i class="fa fa-sitemap mr-2"></i>Process Simplification & Core Flowchart Design
            </h1>
            <div class="flex items-center space-x-4">
                <div id="timer" class="bg-neutral text-white px-3 py-1 rounded-full font-mono">
                    00:00
                </div>
                <button id="helpBtn" class="text-primary hover:text-primary/80 transition-colors">
                    <i class="fa fa-question-circle text-xl"></i>
                </button>
            </div>
        </div>
    </header>

    <!-- Step Navigation -->
    <div class="container mx-auto px-4 py-6">
        <div class="flex flex-wrap justify-between items-center mb-8">
            <div class="flex items-center mb-4 md:mb-0">
                <div id="step1" class="step-active w-10 h-10 rounded-full flex items-center justify-center border mr-2">1</div>
                <span class="font-medium">View Complex Process</span>
            </div>
            <div class="flex items-center mb-4 md:mb-0">
                <div id="step2" class="w-10 h-10 rounded-full flex items-center justify-center border border-gray-300 mr-2">2</div>
                <span class="font-medium text-gray-500">Process Simplification</span>
            </div>
            <div class="flex items-center">
                <div id="step3" class="w-10 h-10 rounded-full flex items-center justify-center border border-gray-300 mr-2">3</div>
                <span class="font-medium text-gray-500">Create Core Flowchart</span>
            </div>
        </div>

        <!-- Main Content Area -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
            <!-- Step 1: Display Complex Process -->
            <div id="step1Content" class="block">
                <h2 class="text-xl font-bold mb-4 text-neutral flex items-center">
                    <i class="fa fa-list-alt text-primary mr-2"></i>Manual Feeding Complex Process
                </h2>
                <div class="bg-gray-50 p-6 rounded-lg border mb-6">
                    <ol class="list-decimal list-inside space-y-3 ml-4" id="complexProcess">
                        <li class="process-item" data-keep="true">User presses the feeding button</li>
                        <li class="process-item" data-keep="false">System confirms if the button is pressed</li>
                        <li class="process-item" data-keep="true">MCU receives button signal</li>
                        <li class="process-item" data-keep="true">Motor starts</li>
                        <li class="process-item" data-keep="false">Weight measurement every 0.3 seconds</li>
                        <li class="process-item" data-keep="true">Motor continues running if weight is insufficient</li>
                        <li class="process-item" data-keep="false">Re-measure weight</li>
                        <li class="process-item" data-keep="true">Motor stops when weight is sufficient</li>
                        <li class="process-item" data-keep="false">Indicator light turns on for notification</li>
                        <li class="process-item" data-keep="true">Record feeding time</li>
                        <li class="process-item" data-keep="true">APP pushes "Feeding Successful" notification</li>
                    </ol>
                </div>
                
                <div class="mb-4 p-4 bg-blue-50 border-l-4 border-primary rounded">
                    <p class="text-sm"><i class="fa fa-info-circle mr-2"></i>Please read the complex process carefully to understand all working steps of the feeding system.</p>
                </div>
                
                <div class="flex justify-end">
                    <button id="toStep2" class="bg-primary hover:bg-primary/90 text-white px-6 py-2 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                        Start Process Simplification <i class="fa fa-arrow-right ml-1"></i>
                    </button>
                </div>
            </div>

            <!-- Step 2: Process Simplification Operation -->
            <div id="step2Content" class="hidden">
                <h2 class="text-xl font-bold mb-4 text-neutral flex items-center">
                    <i class="fa fa-scissors text-accent mr-2"></i>Process Simplification Operation
                </h2>
                <p class="mb-4">Click on the steps below that you consider "irrelevant details" (items to be crossed out):</p>
                
                <div class="bg-gray-50 p-6 rounded-lg border mb-6">
                    <ol class="list-decimal list-inside space-y-3 ml-4" id="simplifiedProcess">
                        <li class="process-item" data-keep="true">User presses the feeding button</li>
                        <li class="process-item" data-keep="false">System confirms if the button is pressed</li>
                        <li class="process-item" data-keep="true">MCU receives button signal</li>
                        <li class="process-item" data-keep="true">Motor starts</li>
                        <li class="process-item" data-keep="false">Weight measurement every 0.3 seconds</li>
                        <li class="process-item" data-keep="true">Motor continues running if weight is insufficient</li>
                        <li class="process-item" data-keep="false">Re-measure weight</li>
                        <li class="process-item" data-keep="true">Motor stops when weight is sufficient</li>
                        <li class="process-item" data-keep="false">Indicator light turns on for notification</li>
                        <li class="process-item" data-keep="true">Record feeding time</li>
                        <li class="process-item" data-keep="true">APP pushes "Feeding Successful" notification</li>
                    </ol>
                </div>
                
                <div class="mb-4 p-4 bg-yellow-50 border-l-4 border-yellow-400 rounded">
                    <p class="text-sm"><i class="fa fa-lightbulb-o mr-2"></i>Tip: Items to be crossed out include "system confirms button press", "weight measurement every 0.3 seconds", and "indicator light notification".</p>
                </div>
                
                <div class="flex justify-between">
                    <button id="backToStep1" class="border border-primary text-primary hover:bg-primary/5 px-6 py-2 rounded-lg transition-colors">
                        <i class="fa fa-arrow-left mr-1"></i> Back
                    </button>
                    <button id="toStep3" class="bg-primary hover:bg-primary/90 text-white px-6 py-2 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                        Create Core Flowchart <i class="fa fa-arrow-right ml-1"></i>
                    </button>
                </div>
            </div>

            <!-- Step 3: Create Core Flowchart -->
            <div id="step3Content" class="hidden">
                <h2 class="text-xl font-bold mb-4 text-neutral flex items-center">
                    <i class="fa fa-sitemap text-secondary mr-2"></i>Create Core Flowchart
                </h2>
                <p class="mb-4">Drag the core steps below to the flowchart area and arrange them in order (Command Input → Core Control → Feeding Execution → Feedback Confirmation):</p>
                
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <!-- Left: Available Nodes -->
                    <div class="bg-gray-50 p-4 rounded-lg border">
                        <h3 class="font-medium mb-3 text-center">Core Steps</h3>
                        <div class="space-y-3" id="availableNodes">
                            <div class="flow-node" draggable="true" data-node="input">Command Input</div>
                            <div class="flow-node" draggable="true" data-node="control">Core Control</div>
                            <div class="flow-node" draggable="true" data-node="execute">Feeding Execution</div>
                            <div class="flow-node" draggable="true" data-node="feedback">Feedback Confirmation</div>
                        </div>
                    </div>
                    
                    <!-- Middle: Flowchart Area -->
                    <div class="bg-gray-50 p-4 rounded-lg border relative min-h-[400px]" id="flowChartArea">
                        <h3 class="font-medium mb-3 text-center">Flowchart Area (Drag steps here)</h3>
                        <div id="connector1" class="flow-connector w-1/4 h-1 top-1/4 left-1/2 transform -translate-x-1/2 hidden"></div>
                        <div id="connector2" class="flow-connector w-1/4 h-1 top-2/4 left-1/2 transform -translate-x-1/2 hidden"></div>
                        <div id="connector3" class="flow-connector w-1/4 h-1 top-3/4 left-1/2 transform -translate-x-1/2 hidden"></div>
                        
                        <div id="dropZone1" class="absolute top-[15%] left-1/2 transform -translate-x-1/2 w-3/4 h-16 border-2 border-dashed border-gray-300 rounded flex items-center justify-center">
                            <span class="text-gray-400 text-sm">Step 1: Command Input</span>
                        </div>
                        <div id="dropZone2" class="absolute top-[40%] left-1/2 transform -translate-x-1/2 w-3/4 h-16 border-2 border-dashed border-gray-300 rounded flex items-center justify-center">
                            <span class="text-gray-400 text-sm">Step 2: Core Control</span>
                        </div>
                        <div id="dropZone3" class="absolute top-[65%] left-1/2 transform -translate-x-1/2 w-3/4 h-16 border-2 border-dashed border-gray-300 rounded flex items-center justify-center">
                            <span class="text-gray-400 text-sm">Step 3: Feeding Execution</span>
                        </div>
                        <div id="dropZone4" class="absolute top-[90%] left-1/2 transform -translate-x-1/2 w-3/4 h-16 border-2 border-dashed border-gray-300 rounded flex items-center justify-center">
                            <span class="text-gray-400 text-sm">Step 4: Feedback Confirmation</span>
                        </div>
                    </div>
                    
                    <!-- Right: Instructions -->
                    <div class="bg-gray-50 p-4 rounded-lg border">
                        <h3 class="font-medium mb-3">Step Explanations</h3>
                        <ul class="space-y-4 text-sm">
                            <li class="flex">
                                <span class="font-medium w-24">Command Input:</span>
                                <span>User actions like pressing the feeding button</span>
                            </li>
                            <li class="flex">
                                <span class="font-medium w-24">Core Control:</span>
                                <span>MCU receives signals and performs judgment processing</span>
                            </li>
                            <li class="flex">
                                <span class="font-medium w-24">Feeding Execution:</span>
                                <span>Motor activation, material feeding and other execution operations</span>
                            </li>
                            <li class="flex">
                                <span class="font-medium w-24">Feedback Confirmation:</span>
                                <span>Weight detection, time recording, notification pushing, etc.</span>
                            </li>
                        </ul>
                        
                        <div class="mt-6 p-4 bg-green-50 border-l-4 border-secondary rounded">
                            <p class="text-sm"><i class="fa fa-check-circle mr-2"></i>After completing the flowchart, click the "Submit" button to finish the task.</p>
                        </div>
                    </div>
                </div>
                
                <div class="flex justify-between mt-6">
                    <button id="backToStep2" class="border border-primary text-primary hover:bg-primary/5 px-6 py-2 rounded-lg transition-colors">
                        <i class="fa fa-arrow-left mr-1"></i> Back
                    </button>
                    <button id="submitBtn" class="bg-secondary hover:bg-secondary/90 text-white px-6 py-2 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                        Submit <i class="fa fa-check ml-1"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Tool Practice Area -->
        <div class="bg-white rounded-xl shadow-lg p-6">
            <h2 class="text-xl font-bold mb-4 text-neutral flex items-center">
                <i class="fa fa-external-link text-accent mr-2"></i>Online Tool Practice
            </h2>
            <p class="mb-4">After completing the above exercises, you can use the following online tool to create the official core flowchart:</p>
            
            <div class="flex flex-col md:flex-row items-center justify-between p-4 bg-gray-50 rounded-lg border mb-4">
                <div class="flex items-center mb-4 md:mb-0">
                    <i class="fa fa-globe text-2xl text-primary mr-3"></i>
                    <div>
                        <p class="font-medium">diagrams.net Online Diagram Tool</p>
                        <p class="text-sm text-gray-500">A free tool for creating professional flowcharts</p>
                    </div>
                </div>
                <a href="https://app.diagrams.net/" target="_blank" class="inline-flex items-center bg-primary hover:bg-primary/90 text-white px-6 py-2 rounded-lg transition-colors">
                    Open Tool <i class="fa fa-external-link ml-1"></i>
                </a>
            </div>
            
            <div class="p-4 bg-blue-50 border-l-4 border-primary rounded">
                <p class="text-sm"><i class="fa fa-info-circle mr-2"></i>Usage Tip: After opening the tool, select a blank diagram and use the flowchart shape library to create a flowchart following the four core steps ("Command Input → Core Control → Feeding Execution → Feedback Confirmation"). Save and submit it to the class group after completion.</p>
            </div>
        </div>
    </div>

    <!-- Completion Modal -->
    <div id="successModal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-xl p-8 max-w-md w-full mx-4 transform transition-all">
            <div class="text-center">
                <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fa fa-check text-2xl text-secondary"></i>
                </div>
                <h3 class="text-xl font-bold mb-2">Congratulations!</h3>
                <p class="text-gray-600 mb-6">You have successfully completed the process simplification and core flowchart design exercises.</p>
                <div class="flex flex-col sm:flex-row gap-3 justify-center">
                    <button id="resetBtn" class="border border-primary text-primary hover:bg-primary/5 px-6 py-2 rounded-lg transition-colors">
                        Restart
                    </button>
                    <button id="closeModalBtn" class="bg-secondary hover:bg-secondary/90 text-white px-6 py-2 rounded-lg transition-colors">
                        Go to Online Tool
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Help Modal -->
    <div id="helpModal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-xl p-6 max-w-lg w-full mx-4 max-h-[80vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold">Usage Help</h3>
                <button id="closeHelpBtn" class="text-gray-500 hover:text-gray-700">
                    <i class="fa fa-times text-xl"></i>
                </button>
            </div>
            <div class="space-y-4 text-sm">
                <div>
                    <h4 class="font-medium mb-2">Step 1: View Complex Process</h4>
                    <p>Carefully read the complete complex process of manual feeding to understand all working steps of the system.</p>
                </div>
                <div>
                    <h4 class="font-medium mb-2">Step 2: Process Simplification</h4>
                    <p>Identify and remove "irrelevant details" from the process, including: system button confirmation, weight measurement every 0.3 seconds, and indicator light notification. Click on these steps to cross them out.</p>
                </div>
                <div>
                    <h4 class="font-medium mb-2">Step 3: Create Core Flowchart</h4>
                    <p>Drag the core steps (Command Input, Core Control, Feeding Execution, Feedback Confirmation) to their corresponding positions in the flowchart area and arrange them in order.</p>
                </div>
                <div>
                    <h4 class="font-medium mb-2">Online Tool Practice</h4>
                    <p>After completing the exercises, use the diagrams.net online tool to create the official core flowchart and submit it to the class group.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Timer Functionality
        let timerInterval;
        let seconds = 0;
        
        function startTimer() {
            if (timerInterval) clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                seconds++;
                const minutes = Math.floor(seconds / 60);
                const remainingSeconds = seconds % 60;
                document.getElementById('timer').textContent = 
                    `${minutes.toString().padStart(2, '0')}:${remainingSeconds.toString().padStart(2, '0')}`;
            }, 1000);
        }
        
        function stopTimer() {
            clearInterval(timerInterval);
        }
        
        function resetTimer() {
            stopTimer();
            seconds = 0;
            document.getElementById('timer').textContent = '00:00';
        }

        // Step Navigation Functionality
        function goToStep(stepNumber) {
            // Hide all step contents
            document.getElementById('step1Content').classList.add('hidden');
            document.getElementById('step2Content').classList.add('hidden');
            document.getElementById('step3Content').classList.add('hidden');
            
            // Reset all step styles
            document.getElementById('step1').classList.remove('step-active');
            document.getElementById('step2').classList.remove('step-active');
            document.getElementById('step3').classList.remove('step-active');
            
            // Show current step content and style
            document.getElementById(`step${stepNumber}Content`).classList.remove('hidden');
            document.getElementById(`step${stepNumber}`).classList.add('step-active');
            
            // Start timer (only when entering Step 1)
            if (stepNumber === 1 && seconds === 0) {
                startTimer();
            }
        }

        // Step 1 Related Logic
        document.addEventListener('DOMContentLoaded', () => {
            // Enable next step button after 5 seconds
            setTimeout(() => {
                document.getElementById('toStep2').removeAttribute('disabled');
            }, 5000);
            
            // Navigate from Step 1 to Step 2
            document.getElementById('toStep2').addEventListener('click', () => {
                goToStep(2);
            });
            
            // Navigate back from Step 2 to Step 1
            document.getElementById('backToStep1').addEventListener('click', () => {
                goToStep(1);
            });
            
            // Navigate back from Step 3 to Step 2
            document.getElementById('backToStep2').addEventListener('click', () => {
                goToStep(2);
            });

            // Process Simplification Operation
            const processItems = document.querySelectorAll('#simplifiedProcess .process-item');
            let removedCount = 0;
            
            processItems.forEach(item => {
                item.addEventListener('click', () => {
                    // Check if the item should be removed
                    if (!item.dataset.keep || item.dataset.keep === 'false') {
                        item.classList.toggle('removed');
                        
                        if (item.classList.contains('removed')) {
                            removedCount++;
                        } else {
                            removedCount--;
                        }
                        
                        // Enable next step when 3 items are correctly removed
                        if (removedCount === 3) {
                            document.getElementById('toStep3').removeAttribute('disabled');
                        } else {
                            document.getElementById('toStep3').setAttribute('disabled', 'true');
                        }
                    } else {
                        // Highlight to indicate this item cannot be removed
                        item.classList.add('highlight');
                        setTimeout(() => {
                            item.classList.remove('highlight');
                        }, 1000);
                    }
                });
            });
            
            // Navigate from Step 2 to Step 3
            document.getElementById('toStep3').addEventListener('click', () => {
                goToStep(3);
            });

            // Flowchart Drag-and-Drop Functionality
            const dropZones = [
                document.getElementById('dropZone1'),
                document.getElementById('dropZone2'),
                document.getElementById('dropZone3'),
                document.getElementById('dropZone4')
            ];
            
            const connectors = [
                document.getElementById('connector1'),
                document.getElementById('connector2'),
                document.getElementById('connector3')
            ];
            
            const requiredNodes = ['input', 'control', 'execute', 'feedback'];
            let placedNodes = [];
            
            // Add events to draggable nodes
            document.querySelectorAll('#availableNodes .flow-node').forEach(node => {
                node.addEventListener('dragstart', (e) => {
                    e.dataTransfer.setData('text/plain', node.dataset.node);
                    setTimeout(() => {
                        node.classList.add('opacity-50');
                    }, 0);
                });
                
                node.addEventListener('dragend', () => {
                    node.classList.remove('opacity-50');
                });
            });
            
            // Add events to drop zones
            dropZones.forEach((zone, index) => {
                zone.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    zone.classList.add('border-primary');
                });
                
                zone.addEventListener('dragleave', () => {
                    zone.classList.remove('border-primary');
                });
                
                zone.addEventListener('drop', (e) => {
                    e.preventDefault();
                    zone.classList.remove('border-primary');
                    
                    const nodeType = e.dataTransfer.getData('text/plain');
                    
                    // Check if the node is placed in the correct position
                    if (requiredNodes[index] === nodeType && !placedNodes.includes(nodeType)) {
                        // Clear the zone content
                        zone.innerHTML = '';
                        
                        // Create new node and add to the zone
                        const newNode = document.createElement('div');
                        newNode.className = 'flow-node active w-full h-full flex items-center justify-center';
                        newNode.textContent = getNodeText(nodeType);
                        newNode.dataset.node = nodeType;
                        zone.appendChild(newNode);
                        
                        // Record placed nodes
                        placedNodes.push(nodeType);
                        
                        // Show connection lines
                        if (index < connectors.length) {
                            connectors[index].classList.remove('hidden');
                        }
                        
                        // Enable submit button when all nodes are correctly placed
                        if (placedNodes.length === 4) {
                            document.getElementById('submitBtn').removeAttribute('disabled');
                        }
                    } else {
                        // Highlight to indicate incorrect placement
                        zone.classList.add('border-accent');
                        setTimeout(() => {
                            zone.classList.remove('border-accent');
                        }, 1000);
                    }
                });
            });
            
            // Get node display text based on node type
            function getNodeText(nodeType) {
                const texts = {
                    'input': 'Command Input',
                    'control': 'Core Control',
                    'execute': 'Feeding Execution',
                    'feedback': 'Feedback Confirmation'
                };
                return texts[nodeType] || '';
            }
            
            // Submit Button Functionality
            document.getElementById('submitBtn').addEventListener('click', () => {
                stopTimer();
                document.getElementById('successModal').classList.remove('hidden');
            });
            
            // Modal Button Functionality
            document.getElementById('closeModalBtn').addEventListener('click', () => {
                document.getElementById('successModal').classList.add('hidden');
                window.open('https://app.diagrams.net/', '_blank');
            });
            
            document.getElementById('resetBtn').addEventListener('click', () => {
                document.getElementById('successModal').classList.add('hidden');
                resetTimer();
                resetAllSteps();
                goToStep(1);
            });
            
            // Help Button Functionality
            document.getElementById('helpBtn').addEventListener('click', () => {
                document.getElementById('helpModal').classList.remove('hidden');
            });
            
            document.getElementById('closeHelpBtn').addEventListener('click', () => {
                document.getElementById('helpModal').classList.add('hidden');
            });
            
            // Reset All Steps Functionality
            function resetAllSteps() {
                // Reset Step 2
                processItems.forEach(item => {
                    item.classList.remove('removed');
                });
                removedCount = 0;
                document.getElementById('toStep3').setAttribute('disabled', 'true');
                
                // Reset Step 3
                dropZones.forEach(zone => {
                    zone.innerHTML = `<span class="text-gray-400 text-sm">Step ${zone.id.replace('dropZone', '')}: ${getNodeText(requiredNodes[zone.id.replace('dropZone', '') - 1])}</span>`;
                });
                
                connectors.forEach(connector => {
                    connector.classList.add('hidden');
                });
                
                placedNodes = [];
                document.getElementById('submitBtn').setAttribute('disabled', 'true');
            }
            
            // Show Step 1 by default
            goToStep(1);
        });
    </script>
</body>
</html>