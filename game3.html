<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>20g Quantitative Feeding Algorithm Verification</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#165DFF',
                        secondary: '#FF4D4F',
                        success: '#52C41A',
                        neutral: '#6B7280',
                        light: '#F9FAFB'
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif']
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .step-box {
                @apply border-2 rounded-lg p-4 transition-all duration-300;
            }
            .step-active {
                @apply border-primary bg-primary/5 shadow-md;
            }
            .step-correct {
                @apply border-success bg-success/5;
            }
            .step-error {
                @apply border-secondary bg-secondary/5;
            }
            .code-block {
                @apply font-mono text-sm bg-gray-100 p-3 rounded-lg my-2 overflow-x-auto;
            }
        }
    </style>
</head>
<body class="bg-light min-h-screen">
    <div class="container mx-auto px-4 py-6 max-w-4xl">
        <!-- Header Section -->
        <header class="text-center mb-8">
            <div class="flex items-center justify-center gap-2 text-primary mb-2">
                <i class="fa fa-robot text-2xl"></i>
                <h1 class="text-2xl md:text-3xl font-bold">20g Quantitative Feeding Algorithm Verification</h1>
            </div>
            <p class="text-neutral">Complete and verify pseudocode steps to implement smart feeder quantification</p>
        </header>

        <!-- Main Content Area -->
        <main class="bg-white rounded-xl shadow-lg p-6 mb-8">
            <!-- Known Conditions Section -->
            <section class="mb-8">
                <h2 class="text-lg font-bold text-dark mb-3 flex items-center">
                    <i class="fa fa-info-circle text-primary mr-2"></i>Known Conditions
                </h2>
                <div class="bg-blue-50 p-4 rounded-lg border-l-4 border-primary">
                    <ul class="list-disc list-inside space-y-1 text-dark">
                        <li>Target feeding amount is fixed at 20g; motor dispenses 5g per rotation</li>
                        <li>MCU can receive user commands (e.g., app click) and control motor rotation</li>
                        <li>System can record motor rotations and calculate current feeding amount</li>
                    </ul>
                </div>
            </section>

            <!-- Pseudocode Input Section -->
            <section class="mb-8">
                <h2 class="text-lg font-bold text-dark mb-4 flex items-center">
                    <i class="fa fa-code text-primary mr-2"></i>Pseudocode Step Input
                </h2>
                
                <div class="space-y-6">
                    <!-- Input Parameters -->
                    <div class="step-box" id="inputSection">
                        <div class="flex items-center justify-between mb-2">
                            <h3 class="font-bold text-dark">Input Parameters</h3>
                            <span class="text-xs px-2 py-1 bg-primary/10 text-primary rounded-full">Basic Parameters</span>
                        </div>
                        <p class="text-sm text-neutral mb-2">Define target feeding amount and per-rotation dispense:</p>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm text-dark mb-1">Target Feeding Amount</label>
                                <input type="text" id="targetWeight" class="w-full p-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-primary/50" placeholder="e.g.: 20g">
                            </div>
                            <div>
                                <label class="block text-sm text-dark mb-1">Dispense per Rotation</label>
                                <input type="text" id="perCircle" class="w-full p-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-primary/50" placeholder="e.g.: 5g">
                            </div>
                        </div>
                        <div id="inputTip" class="mt-2 text-sm hidden"></div>
                    </div>

                    <!-- Step 1 -->
                    <div class="step-box" id="step1Section">
                        <div class="flex items-center justify-between mb-2">
                            <h3 class="font-bold text-dark">Step 1: Receive Command</h3>
                            <span class="text-xs px-2 py-1 bg-primary/10 text-primary rounded-full">Trigger Phase</span>
                        </div>
                        <p class="text-sm text-neutral mb-2">Describe how MCU receives user command:</p>
                        <textarea id="step1Input" class="w-full p-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-primary/50" rows="2" placeholder="e.g.: MCU receives user feeding command "></textarea>
                        <div id="step1Tip" class="mt-2 text-sm hidden"></div>
                    </div>

                    <!-- Step 2 -->
                    <div class="step-box" id="step2Section">
                        <div class="flex items-center justify-between mb-2">
                            <h3 class="font-bold text-dark">Step 2: Initialization</h3>
                            <span class="text-xs px-2 py-1 bg-primary/10 text-primary rounded-full">Preparation Phase</span>
                        </div>
                        <p class="text-sm text-neutral mb-2">Describe motor activation and initialization:</p>
                        <textarea id="step2Input" class="w-full p-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-primary/50" rows="2" placeholder="e.g.: Motor starts forward rotation, initialize current rotations = 0"></textarea>
                        <div id="step2Tip" class="mt-2 text-sm hidden"></div>
                    </div>

                    <!-- Step 3 -->
                    <div class="step-box" id="step3Section">
                        <div class="flex items-center justify-between mb-2">
                            <h3 class="font-bold text-dark">Step 3: Counting & Calculation</h3>
                            <span class="text-xs px-2 py-1 bg-primary/10 text-primary rounded-full">Core Phase</span>
                        </div>
                        <p class="text-sm text-neutral mb-2">Describe rotation counting and amount calculation logic:</p>
                        <textarea id="step3Input" class="w-full p-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-primary/50" rows="2" placeholder="e.g.: For each rotation, current rotations = current rotations + 1, calculate current amount = current rotations × per-rotation dispense"></textarea>
                        <div id="step3Tip" class="mt-2 text-sm hidden"></div>
                    </div>

                    <!-- Step 4 -->
                    <div class="step-box" id="step4Section">
                        <div class="flex items-center justify-between mb-2">
                            <h3 class="font-bold text-dark">Step 4: Judgment & Control</h3>
                            <span class="text-xs px-2 py-1 bg-primary/10 text-primary rounded-full">Decision Phase</span>
                        </div>
                        <p class="text-sm text-neutral mb-2">Describe amount judgment and motor control logic:</p>
                        <textarea id="step4Input" class="w-full p-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-primary/50" rows="2" placeholder="e.g.: Check if current amount ≥ target amount? Yes: stop motor; No: return to Step 3"></textarea>
                        <div id="step4Tip" class="mt-2 text-sm hidden"></div>
                    </div>

                    <!-- Output Section -->
                    <div class="step-box" id="outputSection">
                        <div class="flex items-center justify-between mb-2">
                            <h3 class="font-bold text-dark">Output Result</h3>
                            <span class="text-xs px-2 py-1 bg-primary/10 text-primary rounded-full">Feedback Phase</span>
                        </div>
                        <p class="text-sm text-neutral mb-2">Describe final output content:</p>
                        <textarea id="outputInput" class="w-full p-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-primary/50" rows="2" placeholder="e.g.: Record 'feeding successful' and push result to app"></textarea>
                        <div id="outputTip" class="mt-2 text-sm hidden"></div>
                    </div>
                </div>
            </section>

            <!-- Action Buttons -->
            <section class="flex flex-wrap gap-4 justify-center mb-6">
                <button id="checkBtn" class="px-6 py-2.5 bg-primary text-white rounded-lg font-medium hover:bg-primary/90 transition-all flex items-center gap-2">
                    <i class="fa fa-check-circle"></i>Verify Algorithm
                </button>
                <button id="fillBtn" class="px-6 py-2.5 bg-neutral text-white rounded-lg font-medium hover:bg-neutral/90 transition-all flex items-center gap-2">
                    <i class="fa fa-magic"></i>Auto-Fill
                </button>
                <button id="resetBtn" class="px-6 py-2.5 bg-gray-200 text-dark rounded-lg font-medium hover:bg-gray-300 transition-all flex items-center gap-2">
                    <i class="fa fa-refresh"></i>Reset
                </button>
            </section>

            <!-- Verification Result Section -->
            <section id="resultSection" class="hidden">
                <div class="border-2 rounded-xl p-5 mb-6">
                    <h2 class="text-lg font-bold text-dark mb-4 flex items-center">
                        <i class="fa fa-bar-chart text-primary mr-2"></i>Algorithm Verification Result
                    </h2>
                    <div id="resultList" class="space-y-3 mb-4"></div>
                    <div class="flex justify-between items-center">
                        <div>
                            <span class="text-sm text-neutral">Total Score:</span>
                            <span id="totalScore" class="text-2xl font-bold text-success ml-1">0</span>
                        </div>
                        <button id="simulateBtn" class="px-4 py-2 bg-success text-white rounded-lg text-sm font-medium hover:bg-success/90 transition-all hidden">
                            <i class="fa fa-play-circle"></i>Run Simulation
                        </button>
                    </div>
                </div>
            </section>

            <!-- Algorithm Simulation Section -->
            <section id="simulationSection" class="hidden">
                <div class="border-2 border-primary rounded-xl p-5 bg-primary/5">
                    <h2 class="text-lg font-bold text-primary mb-4 flex items-center">
                        <i class="fa fa-cogs mr-2"></i>Feeding Process Simulation
                    </h2>
                    <div class="code-block" id="simulationLog">
                        <!-- Simulation log will be inserted here dynamically -->
                    </div>
                    <div class="mt-4 flex justify-center">
                        <button id="reSimulateBtn" class="px-4 py-2 bg-primary text-white rounded-lg text-sm font-medium hover:bg-primary/90 transition-all">
                            <i class="fa fa-repeat"></i>Re-simulate
                        </button>
                    </div>
                </div>
            </section>
        </main>

        <!-- Standard Pseudocode Reference -->
        <section class="bg-white rounded-xl shadow-lg p-6 mb-8">
            <h2 class="text-lg font-bold text-dark mb-3 flex items-center">
                <i class="fa fa-book text-primary mr-2"></i>Standard Pseudocode Reference
            </h2>
            <div class="code-block">
                <p># 20g Quantitative Feeding Algorithm (Pseudocode)</p>
                <p>Input: Target amount = 20g, Dispense per rotation = 5g</p>
                <p>Step 1: MCU receives user feeding command (e.g., app click)</p>
                <p>Step 2: Motor starts forward rotation, initialize current rotations = 0</p>
                <p>Step 3: For each rotation, current rotations = current rotations + 1<br>
                &nbsp;&nbsp;&nbsp;&nbsp;Calculate current amount = current rotations × dispense per rotation (5g)</p>
                <p>Step 4: Check if current amount ≥ target amount (20g)?<br>
                &nbsp;&nbsp;&nbsp;&nbsp;- Yes: Stop motor rotation<br>
                &nbsp;&nbsp;&nbsp;&nbsp;- No: Return to Step 3, continue rotation</p>
                <p>Output: Record "feeding successful" and push result to app</p>
            </div>
        </section>

        <!-- Footer -->
        <footer class="text-center text-neutral text-sm">
            <p>Smart Feeder Algorithm Teaching Tool © 2024</p>
        </footer>
    </div>

    <script>
        // Core data
        const correctAnswers = {
            input: { target: '20g', perCircle: '5g' },
            step1: 'MCU receives user feeding command ',
            step2: 'Motor starts forward rotation, initialize current rotations = 0',
            step3: 'For each rotation, current rotations = current rotations + 1 Calculate current amount = current rotations × dispense per rotation',
            step4: 'Check if current amount ≥ target amount? Yes: Stop motor rotation No: Return to Step 3, continue rotation',
            output: 'Record "feeding successful" and push result to app'
        };

        // DOM elements
        const inputElements = {
            target: document.getElementById('targetWeight'),
            perCircle: document.getElementById('perCircle'),
            tip: document.getElementById('inputTip'),
            section: document.getElementById('inputSection')
        };

        const stepElements = [
            {
                input: document.getElementById('step1Input'),
                tip: document.getElementById('step1Tip'),
                section: document.getElementById('step1Section'),
                name: 'Step 1'
            },
            {
                input: document.getElementById('step2Input'),
                tip: document.getElementById('step2Tip'),
                section: document.getElementById('step2Section'),
                name: 'Step 2'
            },
            {
                input: document.getElementById('step3Input'),
                tip: document.getElementById('step3Tip'),
                section: document.getElementById('step3Section'),
                name: 'Step 3'
            },
            {
                input: document.getElementById('step4Input'),
                tip: document.getElementById('step4Tip'),
                section: document.getElementById('step4Section'),
                name: 'Step 4'
            }
        ];

        const outputElements = {
            input: document.getElementById('outputInput'),
            tip: document.getElementById('outputTip'),
            section: document.getElementById('outputSection')
        };

        // Button elements
        const checkBtn = document.getElementById('checkBtn');
        const fillBtn = document.getElementById('fillBtn');
        const resetBtn = document.getElementById('resetBtn');
        const simulateBtn = document.getElementById('simulateBtn');
        const reSimulateBtn = document.getElementById('reSimulateBtn');

        // Result elements
        const resultSection = document.getElementById('resultSection');
        const resultList = document.getElementById('resultList');
        const totalScoreEl = document.getElementById('totalScore');
        const simulationSection = document.getElementById('simulationSection');
        const simulationLog = document.getElementById('simulationLog');

        // Verify algorithm
        checkBtn.addEventListener('click', () => {
            let totalScore = 0;
            resultList.innerHTML = '';
            
            // Verify input parameters
            let inputScore = 0;
            if (inputElements.target.value.trim() === correctAnswers.input.target && 
                inputElements.perCircle.value.trim() === correctAnswers.input.perCircle) {
                inputScore = 20;
                showTip(inputElements.tip, '✅ Correct input parameters', 'text-success');
                setStepStatus(inputElements.section, 'correct');
            } else {
                showTip(inputElements.tip, '❌ Incorrect input parameters (Correct: Target 20g, 5g per rotation)', 'text-secondary');
                setStepStatus(inputElements.section, 'error');
            }
            addResultItem('Input Parameters', inputScore);
            totalScore += inputScore;

            // Verify steps
            stepElements.forEach((step, index) => {
                const stepKey = `step${index + 1}`;
                const userInput = step.input.value.trim().replace(/\s+/g, ' ');
                const correctInput = correctAnswers[stepKey].replace(/\s+/g, ' ');
                let score = 0;

                if (userInput === correctInput) {
                    score = 20;
                    showTip(step.tip, `✅ ${step.name} correct`, 'text-success');
                    setStepStatus(step.section, 'correct');
                } else {
                    showTip(step.tip, `❌ ${step.name} incorrect (Reference: ${correctAnswers[stepKey]})`, 'text-secondary');
                    setStepStatus(step.section, 'error');
                }
                
                addResultItem(step.name, score);
                totalScore += score;
            });

            // Verify output
            let outputScore = 0;
            const userOutput = outputElements.input.value.trim().replace(/\s+/g, ' ');
            const correctOutput = correctAnswers.output.replace(/\s+/g, ' ');
            
            if (userOutput === correctOutput) {
                outputScore = 20;
                showTip(outputElements.tip, '✅ Correct output result', 'text-success');
                setStepStatus(outputElements.section, 'correct');
            } else {
                showTip(outputElements.tip, `❌ Incorrect output result (Reference: ${correctAnswers.output})`, 'text-secondary');
                setStepStatus(outputElements.section, 'error');
            }
            addResultItem('Output Result', outputScore);
            totalScore += outputScore;

            // Show results
            totalScoreEl.textContent = `${totalScore} points`;
            resultSection.classList.remove('hidden');
            
            // Show simulation button for perfect score
            if (totalScore === 100) {
                simulateBtn.classList.remove('hidden');
            } else {
                simulateBtn.classList.add('hidden');
            }
        });

        // Auto-fill function
        fillBtn.addEventListener('click', () => {
            inputElements.target.value = correctAnswers.input.target;
            inputElements.perCircle.value = correctAnswers.input.perCircle;
            
            stepElements[0].input.value = correctAnswers.step1;
            stepElements[1].input.value = correctAnswers.step2;
            stepElements[2].input.value = correctAnswers.step3;
            stepElements[3].input.value = correctAnswers.step4;
            
            outputElements.input.value = correctAnswers.output;
            
            // Clear tips and statuses
            clearAllTips();
            clearAllStepStatus();
        });

        // Reset function
        resetBtn.addEventListener('click', () => {
            inputElements.target.value = '';
            inputElements.perCircle.value = '';
            
            stepElements.forEach(step => {
                step.input.value = '';
            });
            
            outputElements.input.value = '';
            
            clearAllTips();
            clearAllStepStatus();
            resultSection.classList.add('hidden');
            simulationSection.classList.add('hidden');
        });

        // Run simulation
        simulateBtn.addEventListener('click', runSimulation);
        reSimulateBtn.addEventListener('click', runSimulation);

        // Simulate feeding process
        function runSimulation() {
            simulationLog.innerHTML = '';
            simulationSection.classList.remove('hidden');
            
            // Simulation steps
            logSimulation('Starting quantitative feeding process...');
            logSimulation(`1. Input parameters: Target amount=${correctAnswers.input.target}, Dispense per rotation=${correctAnswers.input.perCircle}`);
            logSimulation('2. ' + correctAnswers.step1);
            logSimulation('3. ' + correctAnswers.step2);
            
            // Simulate rotations
            let currentCircle = 0;
            const target = 20;
            const perCircle = 5;
            
            const simulationInterval = setInterval(() => {
                currentCircle++;
                const currentWeight = currentCircle * perCircle;
                logSimulation(`4. Executing Step 3: Current rotations=${currentCircle}, Current amount=${currentWeight}g`);
                
                if (currentWeight >= target) {
                    clearInterval(simulationInterval);
                    logSimulation(`5. Step 4 judgment: Current amount ${currentWeight}g ≥ Target ${target}g → Stopping motor`);
                    logSimulation('6. ' + correctAnswers.output);
                    logSimulation('✅ Quantitative feeding completed!');
                }
            }, 1500);
        }

        // Utility: Show tip
        function showTip(element, text, className) {
            element.textContent = text;
            element.className = `mt-2 text-sm ${className}`;
            element.classList.remove('hidden');
        }

        // Utility: Set step status
        function setStepStatus(element, status) {
            element.classList.remove('step-active', 'step-correct', 'step-error');
            element.classList.add(`step-${status}`);
        }

        // Utility: Add result item
        function addResultItem(name, score) {
            const item = document.createElement('div');
            item.className = 'flex justify-between items-center';
            item.innerHTML = `
                <span>${name}</span>
                <span class="${score === 20 ? 'text-success' : 'text-secondary'} font-medium">${score} points</span>
            `;
            resultList.appendChild(item);
        }

        // Utility: Clear all tips
        function clearAllTips() {
            inputElements.tip.classList.add('hidden');
            stepElements.forEach(step => step.tip.classList.add('hidden'));
            outputElements.tip.classList.add('hidden');
        }

        // Utility: Clear all step statuses
        function clearAllStepStatus() {
            inputElements.section.classList.remove('step-correct', 'step-error');
            stepElements.forEach(step => step.section.classList.remove('step-correct', 'step-error'));
            outputElements.section.classList.remove('step-correct', 'step-error');
        }

        // Utility: Simulation log
        function logSimulation(text) {
            const logItem = document.createElement('p');
            logItem.className = 'mb-1';
            logItem.textContent = `[${new Date().toLocaleTimeString().slice(3)}] ${text}`;
            simulationLog.appendChild(logItem);
            simulationLog.scrollTop = simulationLog.scrollHeight;
        }

        // Input focus effects
        [inputElements.target, inputElements.perCircle, outputElements.input]
            .concat(stepElements.map(step => step.input))
            .forEach(input => {
                input.addEventListener('focus', function() {
                    this.closest('.step-box').classList.add('step-active');
                });
                input.addEventListener('blur', function() {
                    this.closest('.step-box').classList.remove('step-active');
                });
            });
    </script>
</body>
</html>