<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>定量20g喂食算法交互验证</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#165DFF',
                        secondary: '#FF4D4F',
                        success: '#52C41A',
                        neutral: '#6B7280',
                        light: '#F9FAFB'
                    },
                    fontFamily: {
                        sans: ['Microsoft YaHei', 'system-ui', 'sans-serif']
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .step-box {
                @apply border-2 rounded-lg p-4 transition-all duration-300;
            }
            .step-active {
                @apply border-primary bg-primary/5 shadow-md;
            }
            .step-correct {
                @apply border-success bg-success/5;
            }
            .step-error {
                @apply border-secondary bg-secondary/5;
            }
            .code-block {
                @apply font-mono text-sm bg-gray-100 p-3 rounded-lg my-2 overflow-x-auto;
            }
        }
    </style>
</head>
<body class="bg-light min-h-screen">
    <div class="container mx-auto px-4 py-6 max-w-4xl">
        <!-- 标题区 -->
        <header class="text-center mb-8">
            <div class="flex items-center justify-center gap-2 text-primary mb-2">
                <i class="fa fa-robot text-2xl"></i>
                <h1 class="text-2xl md:text-3xl font-bold">定量20g喂食算法验证</h1>
            </div>
            <p class="text-neutral">填写并验证伪代码步骤，实现智能喂食器定量功能</p>
        </header>

        <!-- 核心内容区 -->
        <main class="bg-white rounded-xl shadow-lg p-6 mb-8">
            <!-- 已知条件区 -->
            <section class="mb-8">
                <h2 class="text-lg font-bold text-dark mb-3 flex items-center">
                    <i class="fa fa-info-circle text-primary mr-2"></i>已知条件
                </h2>
                <div class="bg-blue-50 p-4 rounded-lg border-l-4 border-primary">
                    <ul class="list-disc list-inside space-y-1 text-dark">
                        <li>目标食量固定为20g，电机每转动1圈可送料5g</li>
                        <li>MCU可接收用户指令（如APP点击）并控制电机转动</li>
                        <li>系统可记录电机转动圈数，并计算当前送料量</li>
                    </ul>
                </div>
            </section>

            <!-- 伪代码填写区 -->
            <section class="mb-8">
                <h2 class="text-lg font-bold text-dark mb-4 flex items-center">
                    <i class="fa fa-code text-primary mr-2"></i>伪代码步骤填写
                </h2>
                
                <div class="space-y-6">
                    <!-- 输入部分 -->
                    <div class="step-box" id="inputSection">
                        <div class="flex items-center justify-between mb-2">
                            <h3 class="font-bold text-dark">输入参数</h3>
                            <span class="text-xs px-2 py-1 bg-primary/10 text-primary rounded-full">基础参数</span>
                        </div>
                        <p class="text-sm text-neutral mb-2">请定义目标食量和每圈送料量：</p>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm text-dark mb-1">目标食量</label>
                                <input type="text" id="targetWeight" class="w-full p-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-primary/50" placeholder="例如：20g">
                            </div>
                            <div>
                                <label class="block text-sm text-dark mb-1">每圈送料量</label>
                                <input type="text" id="perCircle" class="w-full p-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-primary/50" placeholder="例如：5g">
                            </div>
                        </div>
                        <div id="inputTip" class="mt-2 text-sm hidden"></div>
                    </div>

                    <!-- 步骤1 -->
                    <div class="step-box" id="step1Section">
                        <div class="flex items-center justify-between mb-2">
                            <h3 class="font-bold text-dark">步骤1：接收指令</h3>
                            <span class="text-xs px-2 py-1 bg-primary/10 text-primary rounded-full">触发环节</span>
                        </div>
                        <p class="text-sm text-neutral mb-2">请描述MCU如何接收用户指令：</p>
                        <textarea id="step1Input" class="w-full p-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-primary/50" rows="2" placeholder="例如：MCU接收用户的喂食指令（如APP点击）"></textarea>
                        <div id="step1Tip" class="mt-2 text-sm hidden"></div>
                    </div>

                    <!-- 步骤2 -->
                    <div class="step-box" id="step2Section">
                        <div class="flex items-center justify-between mb-2">
                            <h3 class="font-bold text-dark">步骤2：初始化</h3>
                            <span class="text-xs px-2 py-1 bg-primary/10 text-primary rounded-full">准备环节</span>
                        </div>
                        <p class="text-sm text-neutral mb-2">请描述电机启动和初始化操作：</p>
                        <textarea id="step2Input" class="w-full p-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-primary/50" rows="2" placeholder="例如：电机开始正转，初始化当前圈数 = 0"></textarea>
                        <div id="step2Tip" class="mt-2 text-sm hidden"></div>
                    </div>

                    <!-- 步骤3 -->
                    <div class="step-box" id="step3Section">
                        <div class="flex items-center justify-between mb-2">
                            <h3 class="font-bold text-dark">步骤3：计数与计算</h3>
                            <span class="text-xs px-2 py-1 bg-primary/10 text-primary rounded-full">核心环节</span>
                        </div>
                        <p class="text-sm text-neutral mb-2">请描述圈数计数和食量计算逻辑：</p>
                        <textarea id="step3Input" class="w-full p-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-primary/50" rows="2" placeholder="例如：每转动1圈，当前圈数 = 当前圈数 + 1，计算当前食量 = 当前圈数 × 每圈送料"></textarea>
                        <div id="step3Tip" class="mt-2 text-sm hidden"></div>
                    </div>

                    <!-- 步骤4 -->
                    <div class="step-box" id="step4Section">
                        <div class="flex items-center justify-between mb-2">
                            <h3 class="font-bold text-dark">步骤4：判断与控制</h3>
                            <span class="text-xs px-2 py-1 bg-primary/10 text-primary rounded-full">决策环节</span>
                        </div>
                        <p class="text-sm text-neutral mb-2">请描述食量判断和电机控制逻辑：</p>
                        <textarea id="step4Input" class="w-full p-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-primary/50" rows="2" placeholder="例如：判断当前食量是否 ≥ 目标食量？是：电机停止；否：回到步骤3"></textarea>
                        <div id="step4Tip" class="mt-2 text-sm hidden"></div>
                    </div>

                    <!-- 输出部分 -->
                    <div class="step-box" id="outputSection">
                        <div class="flex items-center justify-between mb-2">
                            <h3 class="font-bold text-dark">输出结果</h3>
                            <span class="text-xs px-2 py-1 bg-primary/10 text-primary rounded-full">反馈环节</span>
                        </div>
                        <p class="text-sm text-neutral mb-2">请描述最终输出内容：</p>
                        <textarea id="outputInput" class="w-full p-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-primary/50" rows="2" placeholder="例如：记录“喂食成功”，并向APP推送结果"></textarea>
                        <div id="outputTip" class="mt-2 text-sm hidden"></div>
                    </div>
                </div>
            </section>

            <!-- 操作按钮区 -->
            <section class="flex flex-wrap gap-4 justify-center mb-6">
                <button id="checkBtn" class="px-6 py-2.5 bg-primary text-white rounded-lg font-medium hover:bg-primary/90 transition-all flex items-center gap-2">
                    <i class="fa fa-check-circle"></i>验证算法
                </button>
                <button id="fillBtn" class="px-6 py-2.5 bg-neutral text-white rounded-lg font-medium hover:bg-neutral/90 transition-all flex items-center gap-2">
                    <i class="fa fa-magic"></i>自动填充
                </button>
                <button id="resetBtn" class="px-6 py-2.5 bg-gray-200 text-dark rounded-lg font-medium hover:bg-gray-300 transition-all flex items-center gap-2">
                    <i class="fa fa-refresh"></i>重置
                </button>
            </section>

            <!-- 验证结果区 -->
            <section id="resultSection" class="hidden">
                <div class="border-2 rounded-xl p-5 mb-6">
                    <h2 class="text-lg font-bold text-dark mb-4 flex items-center">
                        <i class="fa fa-bar-chart text-primary mr-2"></i>算法验证结果
                    </h2>
                    <div id="resultList" class="space-y-3 mb-4"></div>
                    <div class="flex justify-between items-center">
                        <div>
                            <span class="text-sm text-neutral">总评分：</span>
                            <span id="totalScore" class="text-2xl font-bold text-success ml-1">0</span>
                        </div>
                        <button id="simulateBtn" class="px-4 py-2 bg-success text-white rounded-lg text-sm font-medium hover:bg-success/90 transition-all hidden">
                            <i class="fa fa-play-circle"></i>运行模拟
                        </button>
                    </div>
                </div>
            </section>

            <!-- 算法模拟区 -->
            <section id="simulationSection" class="hidden">
                <div class="border-2 border-primary rounded-xl p-5 bg-primary/5">
                    <h2 class="text-lg font-bold text-primary mb-4 flex items-center">
                        <i class="fa fa-cogs mr-2"></i>喂食过程模拟
                    </h2>
                    <div class="code-block" id="simulationLog">
                        <!-- 模拟日志会动态插入这里 -->
                    </div>
                    <div class="mt-4 flex justify-center">
                        <button id="reSimulateBtn" class="px-4 py-2 bg-primary text-white rounded-lg text-sm font-medium hover:bg-primary/90 transition-all">
                            <i class="fa fa-repeat"></i>重新模拟
                        </button>
                    </div>
                </div>
            </section>
        </main>

        <!-- 标准伪代码参考区 -->
        <section class="bg-white rounded-xl shadow-lg p-6 mb-8">
            <h2 class="text-lg font-bold text-dark mb-3 flex items-center">
                <i class="fa fa-book text-primary mr-2"></i>标准伪代码参考
            </h2>
            <div class="code-block">
                <p># 定量喂食20g算法（伪代码）</p>
                <p>输入：目标食量 = 20g，每圈送料 = 5g</p>
                <p>步骤1：MCU接收用户的喂食指令（如APP点击）</p>
                <p>步骤2：电机开始正转，初始化当前圈数 = 0</p>
                <p>步骤3：每转动1圈，当前圈数 = 当前圈数 + 1<br>
                &nbsp;&nbsp;&nbsp;&nbsp;计算当前食量 = 当前圈数 × 每圈送料（5g）</p>
                <p>步骤4：判断当前食量是否 ≥ 目标食量（20g）？<br>
                &nbsp;&nbsp;&nbsp;&nbsp;- 是：电机停止转动<br>
                &nbsp;&nbsp;&nbsp;&nbsp;- 否：回到步骤3，继续转动</p>
                <p>输出：记录“喂食成功”，并向APP推送结果</p>
            </div>
        </section>

        <!-- 页脚 -->
        <footer class="text-center text-neutral text-sm">
            <p>智能喂食器算法教学工具 © 2024</p>
        </footer>
    </div>

    <script>
        // 核心数据
        const correctAnswers = {
            input: { target: '20g', perCircle: '5g' },
            step1: 'MCU接收用户的喂食指令（如APP点击）',
            step2: '电机开始正转，初始化当前圈数 = 0',
            step3: '每转动1圈，当前圈数 = 当前圈数 + 1 计算当前食量 = 当前圈数 × 每圈送料（5g）',
            step4: '判断当前食量是否 ≥ 目标食量（20g）？ 是：电机停止转动 否：回到步骤3，继续转动',
            output: '记录“喂食成功”，并向APP推送结果'
        };

        // DOM元素
        const inputElements = {
            target: document.getElementById('targetWeight'),
            perCircle: document.getElementById('perCircle'),
            tip: document.getElementById('inputTip'),
            section: document.getElementById('inputSection')
        };

        const stepElements = [
            {
                input: document.getElementById('step1Input'),
                tip: document.getElementById('step1Tip'),
                section: document.getElementById('step1Section'),
                name: '步骤1'
            },
            {
                input: document.getElementById('step2Input'),
                tip: document.getElementById('step2Tip'),
                section: document.getElementById('step2Section'),
                name: '步骤2'
            },
            {
                input: document.getElementById('step3Input'),
                tip: document.getElementById('step3Tip'),
                section: document.getElementById('step3Section'),
                name: '步骤3'
            },
            {
                input: document.getElementById('step4Input'),
                tip: document.getElementById('step4Tip'),
                section: document.getElementById('step4Section'),
                name: '步骤4'
            }
        ];

        const outputElements = {
            input: document.getElementById('outputInput'),
            tip: document.getElementById('outputTip'),
            section: document.getElementById('outputSection')
        };

        // 按钮元素
        const checkBtn = document.getElementById('checkBtn');
        const fillBtn = document.getElementById('fillBtn');
        const resetBtn = document.getElementById('resetBtn');
        const simulateBtn = document.getElementById('simulateBtn');
        const reSimulateBtn = document.getElementById('reSimulateBtn');

        // 结果元素
        const resultSection = document.getElementById('resultSection');
        const resultList = document.getElementById('resultList');
        const totalScoreEl = document.getElementById('totalScore');
        const simulationSection = document.getElementById('simulationSection');
        const simulationLog = document.getElementById('simulationLog');

        // 验证算法
        checkBtn.addEventListener('click', () => {
            let totalScore = 0;
            resultList.innerHTML = '';
            
            // 验证输入参数
            let inputScore = 0;
            if (inputElements.target.value.trim() === correctAnswers.input.target && 
                inputElements.perCircle.value.trim() === correctAnswers.input.perCircle) {
                inputScore = 20;
                showTip(inputElements.tip, '✅ 输入参数正确', 'text-success');
                setStepStatus(inputElements.section, 'correct');
            } else {
                showTip(inputElements.tip, '❌ 输入参数错误（正确值：目标食量20g，每圈送料5g）', 'text-secondary');
                setStepStatus(inputElements.section, 'error');
            }
            addResultItem('输入参数', inputScore);
            totalScore += inputScore;

            // 验证步骤
            stepElements.forEach((step, index) => {
                const stepKey = `step${index + 1}`;
                const userInput = step.input.value.trim().replace(/\s+/g, ' ');
                const correctInput = correctAnswers[stepKey].replace(/\s+/g, ' ');
                let score = 0;

                if (userInput === correctInput) {
                    score = 20;
                    showTip(step.tip, `✅ ${step.name}正确`, 'text-success');
                    setStepStatus(step.section, 'correct');
                } else {
                    showTip(step.tip, `❌ ${step.name}错误（参考：${correctAnswers[stepKey]}）`, 'text-secondary');
                    setStepStatus(step.section, 'error');
                }
                
                addResultItem(step.name, score);
                totalScore += score;
            });

            // 验证输出
            let outputScore = 0;
            const userOutput = outputElements.input.value.trim().replace(/\s+/g, ' ');
            const correctOutput = correctAnswers.output.replace(/\s+/g, ' ');
            
            if (userOutput === correctOutput) {
                outputScore = 20;
                showTip(outputElements.tip, '✅ 输出结果正确', 'text-success');
                setStepStatus(outputElements.section, 'correct');
            } else {
                showTip(outputElements.tip, `❌ 输出结果错误（参考：${correctAnswers.output}）`, 'text-secondary');
                setStepStatus(outputElements.section, 'error');
            }
            addResultItem('输出结果', outputScore);
            totalScore += outputScore;

            // 显示结果
            totalScoreEl.textContent = `${totalScore}分`;
            resultSection.classList.remove('hidden');
            
            // 满分显示模拟按钮
            if (totalScore === 100) {
                simulateBtn.classList.remove('hidden');
            } else {
                simulateBtn.classList.add('hidden');
            }
        });

        // 自动填充
        fillBtn.addEventListener('click', () => {
            inputElements.target.value = correctAnswers.input.target;
            inputElements.perCircle.value = correctAnswers.input.perCircle;
            
            stepElements[0].input.value = correctAnswers.step1;
            stepElements[1].input.value = correctAnswers.step2;
            stepElements[2].input.value = correctAnswers.step3;
            stepElements[3].input.value = correctAnswers.step4;
            
            outputElements.input.value = correctAnswers.output;
            
            // 清除提示和状态
            clearAllTips();
            clearAllStepStatus();
        });

        // 重置
        resetBtn.addEventListener('click', () => {
            inputElements.target.value = '';
            inputElements.perCircle.value = '';
            
            stepElements.forEach(step => {
                step.input.value = '';
            });
            
            outputElements.input.value = '';
            
            clearAllTips();
            clearAllStepStatus();
            resultSection.classList.add('hidden');
            simulationSection.classList.add('hidden');
        });

        // 运行模拟
        simulateBtn.addEventListener('click', runSimulation);
        reSimulateBtn.addEventListener('click', runSimulation);

        // 模拟喂食过程
        function runSimulation() {
            simulationLog.innerHTML = '';
            simulationSection.classList.remove('hidden');
            
            // 模拟步骤
            logSimulation('开始定量喂食流程...');
            logSimulation(`1. 输入参数：目标食量=${correctAnswers.input.target}，每圈送料=${correctAnswers.input.perCircle}`);
            logSimulation('2. ' + correctAnswers.step1);
            logSimulation('3. ' + correctAnswers.step2);
            
            // 模拟圈数转动
            let currentCircle = 0;
            const target = 20;
            const perCircle = 5;
            
            const simulationInterval = setInterval(() => {
                currentCircle++;
                const currentWeight = currentCircle * perCircle;
                logSimulation(`4. 步骤3执行：当前圈数=${currentCircle}，当前食量=${currentWeight}g`);
                
                if (currentWeight >= target) {
                    clearInterval(simulationInterval);
                    logSimulation(`5. 步骤4判断：当前食量${currentWeight}g ≥ 目标${target}g → 电机停止转动`);
                    logSimulation('6. ' + correctAnswers.output);
                    logSimulation('✅ 定量喂食完成！');
                }
            }, 1500);
        }

        // 工具函数：显示提示
        function showTip(element, text, className) {
            element.textContent = text;
            element.className = `mt-2 text-sm ${className}`;
            element.classList.remove('hidden');
        }

        // 工具函数：设置步骤状态
        function setStepStatus(element, status) {
            element.classList.remove('step-active', 'step-correct', 'step-error');
            element.classList.add(`step-${status}`);
        }

        // 工具函数：添加结果项
        function addResultItem(name, score) {
            const item = document.createElement('div');
            item.className = 'flex justify-between items-center';
            item.innerHTML = `
                <span>${name}</span>
                <span class="${score === 20 ? 'text-success' : 'text-secondary'} font-medium">${score}分</span>
            `;
            resultList.appendChild(item);
        }

        // 工具函数：清除所有提示
        function clearAllTips() {
            inputElements.tip.classList.add('hidden');
            stepElements.forEach(step => step.tip.classList.add('hidden'));
            outputElements.tip.classList.add('hidden');
        }

        // 工具函数：清除所有步骤状态
        function clearAllStepStatus() {
            inputElements.section.classList.remove('step-correct', 'step-error');
            stepElements.forEach(step => step.section.classList.remove('step-correct', 'step-error'));
            outputElements.section.classList.remove('step-correct', 'step-error');
        }

        // 工具函数：模拟日志
        function logSimulation(text) {
            const logItem = document.createElement('p');
            logItem.className = 'mb-1';
            logItem.textContent = `[${new Date().toLocaleTimeString().slice(3)}] ${text}`;
            simulationLog.appendChild(logItem);
            simulationLog.scrollTop = simulationLog.scrollHeight;
        }

        // 步骤输入聚焦效果
        [inputElements.target, inputElements.perCircle, outputElements.input]
            .concat(stepElements.map(step => step.input))
            .forEach(input => {
                input.addEventListener('focus', function() {
                    this.closest('.step-box').classList.add('step-active');
                });
                input.addEventListener('blur', function() {
                    this.closest('.step-box').classList.remove('step-active');
                });
            });
    </script>
</body>
</html>